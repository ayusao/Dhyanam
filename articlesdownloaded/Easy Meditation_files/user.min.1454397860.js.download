
var user={id:"",submitCnt:1,email:"",name:"",gender:"",dateOfBirth:"",isExistRegForm:false,openFollowOverlay:function(a){if(a!=""){popup.init("/ajaxProfile/"+a,"pp_main");trackPage(a+"?short-profile=1")}},signUpForm:function(){if(user.isExistRegForm){$("#signup-modal-form").hide();$("#forgetPasswordForm").hide();$("#registrationForm").show()}else{var a="/signup";$.ajax({url:a,type:"GET",data:"",dataType:"html",beforeSend:function(){$("#signup-modal-form").hide();$("#forgetPasswordForm").hide();$("#registrationForm").show();$("#registrationForm").html("<div style='width:100%; text-align:center;'><img class='loader' src='/assets/images/ajax-loader-45.gif' /></div>")},success:function(b){user.isExistRegForm=true;$("#registrationForm").html(b)}})}},loginForm:function(){$("#registrationForm").hide();$("#forgetPasswordForm").hide();$("#signup-modal-form").show()},forgetPasswordOptions:function(){$("#registrationForm").hide();$("#signup-modal-form").hide();$("#forgetPasswordForm").show()},checkLogin:function(){this.id=$.cookie("ssoid");if(this.id==null||this.id==""){return false}return true},openLogin:function(c,g){try{if(g){var a=g}var f=0;get_data="pop=1&additional_data="+a+"&return_file=";if(c&&c!=""){get_data+=c}else{get_data+=escape(document.URL)}var b="/login/speakingtree";popup.data=get_data;popup.height="640";popup.width="350";popup.init(b,"pp_main");popup.onResize("pp_main")}catch(d){content.showMessage(d.message,"error")}},OpenProfileImage:function(b){var a=$(b).attr("rowId");$("#"+a).click();this.ReadProfileImage(this,a)},ReadProfileImage:function(a,b){$("#"+b).on("change",function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var g=document.getElementById(b).files[0];var c=g.size;if(c>2097152){content.showMessage("Image size should not be greater than 2 MB","error");return false}else{$("#prfl-img").attr("style","background:#fff");$("#prfl-img").attr("src",base_url+"/assets/images/loadingsample100.gif");var h=g.type;var e=["image/jpeg","image/png","image/jpg"];if(!((h==e[0])||(h==e[1])||(h==e[2]))){return false}else{if(typeof g.name!=="undefined"&&g.name!==""){var d=document.getElementById(b).files[0];var f=new FormData();f.append("userfile",d);f.append("frmAction","saveProfileImage");$.ajax({type:"POST",url:base_url+"/settings/edit-profile-photo",data:f,contentType:false,cache:false,processData:false,beforeSend:function(){},success:function(i){window.location.href=window.location.href}})}}}}})},openRsvp:function(b){if(!user.checkLogin()){csso.openSSOPopup();return false}try{var d=0;get_data="pop=1&event_id="+b;var a="/spiritual-events/rsvpdetail/"+b;popup.data=get_data;popup.height="440";popup.width="250";popup.init(a,"pp_main");popup.onResize("pp_main")}catch(c){content.showMessage(c.message,"error")}},loginOptions:function(d,a,c,b,e){var g=(screen.width/2)-(a/2);var f=(screen.height/2)-(c/2);if(b){}else{}$.cookie("property-access",e,{expires:"",path:"/",domain:".speakingtree.in",secure:false});window.open("/login/"+d,"","width="+a+",height="+c+",top="+f+",left="+g+",scrollbars=yes");if(!b){popup.onClose()}},loginpopup:function(a){$("#"+a).toggle()},loginOptionsSem:function(d,a,c,b){var f=(screen.width/2)-(a/2);var e=(screen.height/2)-(c/2);if(b){globalAction.onSignup="1"}else{globalAction.onSignup="0"}window.open("/login/"+d+"?sem=1","","width="+a+",height="+c+",top="+e+",left="+f+",scrollbars=yes");if(!b){popup.onClose()}},signup:function(a){window.location.href="/"+a},performAction:function(c,d,a,b){if(!user.checkLogin()){csso.openSSOPopup();return false}$.post("/user/"+d,{status:a},function(e){if(e.indexOf("login first")>0){globalAction.setGlobalAction(a,"user_follow_text_a_"+c);user.openLogin();return false}if(e.indexOf("success")>=0){dataParts=e.split("||");if(a=="follow"){$("#user_follow_text_a_"+c).html("following");$("#div_follow_user_"+c).attr("style","");$("#div_follow_user_"+c).addClass("btn_followInterest_Grn");$("#div_follow_user_"+c).removeClass("btn_followInterest_Gry");user_actions_list="";user_actions_list+='<li><a href="javascript:void(0);" onclick="user.performAction(\''+c+"','"+d+"','unfollow')\" >Unfollow</a></li>";user_actions_list+='<li><a href="javascript:void(0);" onclick="user.performAction(\''+c+"','"+d+"','block')\">Block</a></li>";$("#user_actions_list_"+c).html(user_actions_list);if($("#div_arrow_"+c)!=undefined){$("#div_arrow_"+c).show()}}else{if(a=="unfollow"){$("#user_follow_text_a_"+c).html("follow");$("#user_follow_text_a_"+c).attr("onclick","$('#follow_action_"+c+"').click();");$("#div_follow_user_"+c).addClass("btn_followInterest_Gry");$("#div_follow_user_"+c).removeClass("btn_followInterest_Grn");user_actions_list="";user_actions_list+='<li><a id="follow_action_'+c+'" href="javascript:void(0);" onclick="user.performAction(\''+c+"','"+d+"','follow')\" >Follow</a></li>";user_actions_list+='<li><a href="javascript:void(0);" onclick="user.performAction(\''+c+"','"+d+"','block')\">Block</a></li>";$("#user_actions_list_"+c).html(user_actions_list)}else{if(a=="block"){$("#user_follow_text_a_"+c).html("Blocked");$("#div_follow_user_"+c).addClass("btn_followInterest_Red");$("#div_follow_user_"+c).removeClass("btn_followInterest_Grn");$("#div_follow_user_"+c).removeClass("btn_followInterest_Gry");user_actions_list="";user_actions_list+='<li><a href="javascript:void(0);" onclick="user.performAction(\''+c+"','"+d+"','unblock')\" >Unblock</a></li>";$("#user_actions_list_"+c).html(user_actions_list)}else{if(a=="unblock"){$("#user_follow_text_a_"+c).html("Follow");$("#div_follow_user_"+c).addClass("btn_followInterest_Gry");$("#div_follow_user_"+c).removeClass("btn_followInterest_Red");user_actions_list="";user_actions_list+='<li><a href="javascript:void(0);" onclick="user.performAction(\''+c+"','"+d+"','follow')\" >Follow</a></li>";user_actions_list+='<li><a href="javascript:void(0);" onclick="user.performAction(\''+c+"','"+d+"','block')\" >Block</a></li>";$("#user_actions_list_"+c).html(user_actions_list)}}}}}else{popup.onClose();content.showMessage(e,"error")}})},validateFields:function(e){if($.trim($("#email").val())==""){content.showMessage("Please enter email id","error",e);$("#email").focus();return false}else{var d=$.trim($("#email").val());var b=user.checkEmailFormat(d);if(!b){content.showMessage("Please enter valid email id","error",e);$("#email").focus();return false}}if($("#divFName").css("display")=="block"){var h=user.validateName("fname");if(!h){return false}}if($("#divLName").css("display")=="block"){var c=user.validateName("lname");if(!c){return false}}if($("#divGender").css("display")=="block"){if(!$("#optMale").is(":checked")&&!$("#optFemale").is(":checked")){content.showMessage("Please select your gender","error",e);return false}}if($("#divPass").length>0){var a=$("#divPass").css("display");if(a=="block"){if($.trim($("#txtpass").val())==""){content.showMessage("Please enter valid password.","error",e);$("#txtpass").focus();return false}var g=$.trim($("#txtpass").val());var f=$.trim($("#txtrepass").val());if(g!=f){content.showMessage("Please make sure your passwords match","error",e);$("#txtrepass").focus();return false}}}return true},verifyTrap:function(){var a=this.validateFields(true);if(a==true){if(this.submitCnt>1){return false}this.submitCnt++;$("#login").find(":input:disabled").prop("disabled",false);document.login.submit()}},checkEmailStatus:function(b){var c="email="+b;var a="/login/validation?nocache";$.ajax({type:"GET",dataType:"json",data:c,url:a,async:false,beforeSend:function(){},success:function(d){user.email=b;user.name=d.name;user.gender=d.gender;user.dateOfBirth=d.dateOfBirth;user.setEmailStatus(d.status)}});return this.emailStatus},setEmailStatus:function(a){this.emailStatus=a},verifyEmail:function(c){if($.trim(c)!=""){var a=user.checkEmailFormat(c);if(a){var b=this.checkEmailStatus(c);if(b=="localmap"||b=="ssomap"){$("#existingEmail").val(c);$("#existinguser").show();$("#itimespop").click();$("#alreadyExists").val("1");return false}else{$("#existinguser").hide();$("#alreadyExists").val("0")}}}},checkEmailFormat:function(a){a=$.trim(a);var c=/^([a-zA-Z])([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-]))+(\.)([a-zA-Z0-9\.]{2,5})$/;var b=/([a-zA-Z0-9])(\@)([a-zA-Z0-9])/g;if(!c.test(a)){return false}if(!b.test(a)){return false}return true},validateLogin:function(){if($.trim($("#email").val())==""||$("#email").val()=="Please enter email id"){content.showMessage("Please enter valid email id","error",true);$("#email").focus();return false}else{var c=$("#email").val();var b=$("#connect").val();b=b.toLowerCase();var d=/(\@)([a-z])+(\.)([a-z\.]){2,5}/;if(!c.match(d)){if(b=="speakingtree"){}else{if(b=="indiatimes"){c+="@indiatimes.com"}}$("#email").val(c)}if(b=="speakingtree"||b==""){var a=user.checkEmailFormat(c);if(!a){content.showMessage("Please enter valid email id","error",true);$("#email").focus();return false}}}if($.trim($("#password").val())==""){content.showMessage("Please enter valid password.","error",true);$("#password").focus();return false}$("#login").submit()},registerUser:function(){var a=this.validateFields(false);var b=$.trim($("#email").val());if(a==true){if($("#alreadyExists").val()=="0"){document.signup.submit()}else{content.showMessage("You have allready registered, please login","error");return false}}},forgotPassword:function(a,b){popup.init("/forgotpassword?nocache=true","pp_main")},validateForgetPassword:function(){var c=$("#email3").val();var a=user.checkEmailFormat(c);if(!a){content.showMessage("Please enter your email id","error",true);$("#email3").focus();return false}var b=this.checkEmailStatus(c);b=$.trim(b);if(b=="new-register"){content.showMessage("Email does not exists","error")}else{$.post("/forgotpassword?nocache=true",{email:c});$("#forgetPasswordForm").html("An email has been sent to your mailbox.")}return false},delinkAccount:function(a){var a=$("#delinkconnect").val();$.ajax({type:"GET",dataType:"html",data:{social:a},url:"/delinksocial",async:false,beforeSend:function(){},success:function(b){if(b==1){$("#"+a+"delink").hide();$("#"+a+"link").show();$("#"+a+"ticker").removeClass("lnkAccnt_ticker");$("#"+a+"ticker").addClass("lnkAccnt_tickerLight")}}});$("#pp_main").html("");$("#pp_divoverlay").hide();$("#pp_main").hide()},validateProfileUpdate:function(){if($.trim($("#txtVanityId").val())==""){content.showMessage("Please enter your public id","error");$("#txtVanityId").focus();return false}if($.trim($("#txtVanityId").val())!=$.trim($("#txtPrevVanity").val())){if($.trim($("#txtVanityId").val()).length<4||$.trim($("#txtVanityId").val()).length>30){content.showMessage("Public id should be 4-10 characters","error");$("#txtVanityId").focus();return false}var b=$.trim($("#txtVanityId").val());var c=/^[a-z][a-z0-9\-\.]+$/g;if(!b.match(c)){content.showMessage("Please enter a valid id like Rameshkumar","error");$("#txtVanityId").focus();return false}var a=user.checkVanity(b);if(!a){content.showMessage("This is not a valid linkà¥¤","error");$("#txtVanityId").focus();return false}}document.forms.frmUserprofile.submit()},validateName:function(d){var c=$("#"+d+"").val();if(c==""){content.showMessage("Please enter your name","error");$("#"+d+"").focus();return false}else{if($.trim($("#"+d+"").val()).length<3||$.trim($("#"+d+"").val()).length>50){content.showMessage("Your name should be 3-50 character long","error");$("#"+d+"").focus();return false}else{var a=/^[a-zA-Z][a-zA-Z\s]+$/g;if(!c.match(a)){content.showMessage("Please enter a valid name","error");$("#"+d+"").focus();return false}var b=/[\s]{2,}/;if(c.match(b)){content.showMessage("Please enter a valid name","error");$("#"+d+"").focus();return false}}}return true},openUploadDialog:function(a){$("#"+a+"").click()},uploadProfileImage:function(c){var b=/\.jpg|\.jpeg|\.gif|\.png/i;var a=c.value;if(a.search(b)==-1){content.showMessage("You can only upload jpg, jpeg, gif and png type images","error");window.document.frmuploadPicture.reset();return false}document.frmuploadPicture.submit()},getUserFollowersCount:function(){$.post("/getUserFollowersCount","",function(a){count=parseInt(a);if(count!=0){$("#userFollowersCount").html(a)}return false})},loadFollowers:function(c,a){$.ajax({type:"GET",data:{page:c,ajaxRequest:1,sortType:$("#sortType").val()},url:a,aysnc:false,beforeSend:function(){},success:function(d){$("#followersDataDiv").append(d);return false}});try{if(iBeatPgTrend!=undefined){iBeatPgTrend.init()}}catch(b){}},loadFollowings:function(c,a){$.ajax({type:"GET",data:{page:c,ajaxRequest:1,sortType:$("#sortType").val()},url:a,aysnc:false,beforeSend:function(){},success:function(d){$("#followingsDataDiv").append(d);return false}});try{if(iBeatPgTrend!=undefined){iBeatPgTrend.init()}}catch(b){}},submitLogin:function(a){if(a.keyCode==13){user.validateLogin()}},resetChangePassword:function(){var b=document.getElementsByTagName("input");for(var a=0;a<b.length;a++){b[a].value=""}},validateChangePassword:function(){if($("#txtNewPwd").val()==""){content.showMessage("Please enter a new password","error");$("#txtNewPwd").focus();return false}if($("#txtConfPwd").val()==""){content.showMessage("Please re-enter your password","error");$("#txtConfPwd").focus();return false}var a=/^[a-zA-Z0-9]+/;if($("#txtNewPwd").val().length<6||$("#txtNewPwd").val().length>25){content.showMessage("Password should be 6-25 characters long","error");$("#txtNewPwd").focus();return false}if(!$("#txtNewPwd").val().match(a)){content.showMessage("Plese enter a valid password. Alphabest and Numeric word are allowed","error");$("#txtNewPwd").focus();return false}if($("#txtNewPwd").val()!=$("#txtConfPwd").val()){content.showMessage("Please make sure your passwords match","error");$("#txtNewPwd").focus();return false}document.frmChangePassword.submit()},changePasswordSuccess:function(){content.showMessage("Your password is changed successfully");return true},markHeaderFollowerNotificationsRead:function(a){$.post("/markHeaderFollowerNotificationsRead","",function(b){$(a).removeClass("user-alerts-box-active");$(a).addClass("user-alerts-box-deactive");$(a).attr("onmouseover","");$("#headerFollowersCount").html("0");$("#headerFollowersCount").removeClass("txt-clrW");$("#headerFollowersCount").addClass("light-grey-fnt")})},markHeaderNotificationsRead:function(a){$.post("/markHeaderNotificationsRead","",function(b){$(a).removeClass("user-alerts-box-active");$(a).addClass("user-alerts-box-deactive");$(a).attr("onmouseover","");$("#headerNotificationsCount").html("0");$("#headerNotificationsCount").removeClass("txt-clrW");$("#headerNotificationsCount").addClass("light-grey-fnt")})},verifyTrapEmail:function(){var c=$("#email").val();var d=user.checkEmailFormat(c);if(!d){content.showMessage("Please enter valid email","error",trap);$("#email").focus();return false}var b=this.checkEmailStatus(c);$("#status").val(b);if(b=="ssomap"||b=="localmap"){if(user.name!=""){$("#name").val(user.name);$("#divName").hide()}if(user.gender!=""){if(user.gender=="M"){$("#optMale").attr("checked","true")}else{if(user.gender=="F"){$("#optFemale").attr("checked","true")}}$("#divGender").hide()}if(user.dateOfBirth!=""){$("#txtDOB").val(user.dateOfBirth);$("#divDOB").hide()}$("#email").attr("disabled","true");$("#divEmail").removeClass("bckgrnd_white");$("#divEmail").addClass("bckgrnd_grey");$("#email").addClass("bckgrnd_grey");$("#passworddiv").show();$("#password").focus();$("#ssomapmsg").show();$("#divOr").show();$("#sendpwd").show();$("#newregistermsg").hide();$("#trapbtn").text("login");$("#termconditions").hide();var a=$("#trapmain").height()+80;window.resizeTo(595,a)}},sendPassword:function(){var b=$("#email").val();var c="New password has been sent on: "+b;$("#confirmPop").css("top","0");$("#confirmPop").css("font-size","11px");content.showMessage(c);var a="/login/reset-password";$.ajax({type:"POST",data:{email:b},url:a,beforeSend:function(){},success:function(d){}})},FBLogOut:function(){FB.init({appId:111166812375151,status:true,cookie:true,xfbml:true});FB.getLoginStatus(function(a){if(a.authResponse){FB.logout(function(b){window.location=base_url+"/nocache/logout"})}})},user_block_toggle:function(b,a,d,c){if(!user.checkLogin()){csso.openSSOPopup();return false}try{var i={};i.user_id1=b;i.user_id2=a;i.bstatus=c;i.fld=d;var h="";var g="";if(c==2){g="Block User?";h="Are you sure you want to block this user?"}else{g="Unblock User?";h="Are you sure you want to unblock this user?"}show_confirm_diolog(h,8,i,g)}catch(f){}},showMessage:function(c,b,a){content.showMessage(c,b,a)},hideMessage:function(){$(".confirmPop").hide();$(".sucessMsg").hide();$(".errorMsg").hide();$(".alertPop").hide()},FollowMe:function(c,b){var a=$("#csrf_token").val();$.ajax({method:"POST",data:{following:c,status:b,csrf_token:a},url:"/ajax/user-follow-new",aysnc:false,beforeSend:function(){content.showMessage("Please Wait....","success")},success:function(f){var e=f.split(":!@#");if(e[1]=="success"){var d='<button class="btn-follow-profile bold common-btn" id="unfollow" onclick="javascript:user.UnFollowMe(\''+c+"',0)\">UnFollow</button></div>";$("#divunfollowfollow").html(d);content.showMessage(e[0],"success")}else{content.showMessage(e[0],"error")}}})},UnFollowMe:function(c,b){var a=$("#csrf_token").val();$.ajax({method:"POST",data:{following:c,status:b,csrf_token:a},url:"/ajax/user-unfollow-new",aysnc:false,beforeSend:function(){content.showMessage("Please Wait....","success")},success:function(f){console.log(f);var e=f.split(":!@#");if(e[1]=="success"){var d='<button class="btn-follow-profile bold common-btn" id="follow" onclick="javascript:user.FollowMe(\''+c+"',1)\">Follow</button></div>";$("#divunfollowfollow").html(d);content.showMessage(e[0],"success")}else{content.showMessage(e[0],"error")}}})},toggle_unfollow:function(a){if(a==1){$("#follow_1").show();$("#follow_0").hide()}else{$("#follow_1").hide();$("#follow_0").show()}},userStatusForm:function(){popup.init("/user/statusform","pp_main")},userChangePass:function(){popup.init("/settings/changepassword?"+(new Date).getTime(),"pp_main")},userEditProfileForm:function(){popup.init("/user/editprofile?"+(new Date).getTime(),"pp_main")}};